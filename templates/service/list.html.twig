{% extends 'base.html.twig' %}

{% block title %}{{ type }} in Rouen{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="text-center mb-4">{{ type }} in Rouen</h1>

    <!-- Map Container -->
    <div id="map" class="rounded shadow-sm" style="height: 500px; margin-bottom: 20px;"></div>

    <!-- List of Places -->
    <h2 class="mt-4">List of {{ type }}</h2>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Address</th>
                    <th>Website</th>
                    <th>Phone</th>
                </tr>
            </thead>
            <tbody>
                {% if places is empty %}
                    <tr><td colspan="6" class="text-center">No {{ type|lower }} found.</td></tr>
                {% else %}
                    {% for place in places %}
                        <tr>
                            <td>{{ place.id }}</td>
                            <td><a href="/place/{{ place.id }}">{{ place.name }}</a></td>
                            <td>{{ place.type }}</td>
                            <td>{{ place.address is not empty ? place.address : 'No address available' }}</td>
                            <td>{{ place.website is not empty ? '<a href="' ~ place.website ~ '" target="_blank">Visit</a>' : 'No website'|raw }}</td>
                            <td>{{ place.phone is not empty ? place.phone : 'No phone' }}</td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Leaflet.js & Bootstrap -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Initialize Map
    var map = L.map('map').setView([49.4431, 1.0993], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Add Markers for Each Place
    var markers = [];
    {% for place in places %}
        var marker = L.marker([{{ place.latitude }}, {{ place.longitude }}])
            .addTo(map)
            .bindPopup(`<b>{{ place.name }}</b><br>{{ place.type }}`);
        markers.push(marker);
    {% endfor %}

    // Adjust map view to fit all markers if they exist
    if (markers.length > 0) {
        var group = new L.featureGroup(markers);
        map.fitBounds(group.getBounds());
    }
</script>
{% endblock %}
